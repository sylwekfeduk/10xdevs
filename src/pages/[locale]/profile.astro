---
import AppLayout from "@/layouts/AppLayout.astro";
import { ToasterStandalone } from "@/components/ui/toaster-standalone";
import { ProfileView } from "@/components/profile/ProfileView";
import { getLocaleFromUrl, getTranslations, t } from "@/lib/i18n";

// Get locale from URL
const locale = getLocaleFromUrl(Astro.url);
const translations = getTranslations(locale);

// Extract profile translations as a plain object for serialization
const profileTranslations = {
  settingsTitle: translations.profile.settingsTitle,
  settingsDescription: translations.profile.settingsDescription,
  loading: translations.profile.loading,
  error: translations.profile.error,
  retry: translations.profile.retry,
  profileNotFound: translations.profile.profileNotFound,
  profileNotFoundDescription: translations.profile.profileNotFoundDescription,
  profileUpdatedSuccess: translations.profile.profileUpdatedSuccess,
  welcomeTitle: translations.profile.welcomeTitle,
  welcomeDescription: translations.profile.welcomeDescription,
  fullName: translations.profile.fullName,
  fullNamePlaceholder: translations.profile.fullNamePlaceholder,
  avatarUrl: translations.profile.avatarUrl,
  avatarUrlPlaceholder: translations.profile.avatarUrlPlaceholder,
  avatarUrlDescription: translations.profile.avatarUrlDescription,
  allergies: translations.profile.allergies,
  allergiesPlaceholder: translations.profile.allergiesPlaceholder,
  allergiesDescription: translations.profile.allergiesDescription,
  dietaryPreferences: translations.profile.dietaryPreferences,
  dietaryPreferencesPlaceholder: translations.profile.dietaryPreferencesPlaceholder,
  dietaryPreferencesDescription: translations.profile.dietaryPreferencesDescription,
  dislikedIngredients: translations.profile.dislikedIngredients,
  dislikedIngredientsPlaceholder: translations.profile.dislikedIngredientsPlaceholder,
  dislikedIngredientsDescription: translations.profile.dislikedIngredientsDescription,
  saveChanges: translations.profile.saveChanges,
  saving: translations.profile.saving,
  cancel: translations.profile.cancel,
};

// Check if user is authenticated
if (!Astro.locals.user) {
  // Redirect to login if not authenticated
  return Astro.redirect("/login");
}
---

<AppLayout title={t(locale, "profile.pageTitle")}>
  <div class="container mx-auto max-w-3xl px-4 py-8 sm:px-6 lg:px-8">
    <ProfileView client:load translations={profileTranslations} />
  </div>
  <ToasterStandalone client:load />
</AppLayout>
